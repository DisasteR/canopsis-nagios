# Nagios or Icinga Event broker for Canopsis #

## Requirements ##

Debian like (Debian, Ubuntu ...):

    apt-get install build-essential git-core


Redhat like (Centos ..):

    yum groupinstall "Development Tools"
    yum install git-core


## Download and Build ##

via git:

    git clone https://github.com/capensis/canopsis-nagios.git
    cd canopsis-nagios
    make

via HTTP:

    wget --no-check-certificate  https://github.com/capensis/canopsis-nagios/tarball/master -O canopsis-nagios.tgz
    tar xfz canopsis-nagios.tgz
    cd canopsis-*
    make

## Install ##

Copy NEB in your Nagios/Icinga installation:

    sudo cp src/neb2amqp.o /usr/local/nagios/bin/


## Configure ##

Edit your Nagios/Icinga configuration (nagios.cfg):

    event_broker_options=-1
    broker_module=/usr/local/nagios/bin/neb2amqp.o name=Central host=localhost

Options:

    host =          AMQP Server (127.0.0.1)
    port =          AMQP Port (5672)
    userid =        AMQP login (guest)
    password =      AMQP password (guest)
    virtual_host =  AMQP Virtual host (canopsis)
    exchange_name = AMQP Exchange (canopsis.events)
    name =          Poller name (Central)
    connector =     Connector name (nagios) (you can type "icinga" for icinga)

If nagios.cfg is generated by other program, you can try to add in your nagios init script:

    CPS_NEB=$prefix/bin/neb2amqp.o
    CPS_NAME=$(hostname -s)
    CPS_SERVER="odeon.root.local"
    if [ -e $CPS_NEB ]; then
            grep "$CPS_NEB" $NagiosCfgFile 1> /dev/null
            if [ $? -ne 0 ]; then
                echo "Add NEB: '$CPS_NEB' to configuration file '$NagiosCfgFile'"
                echo "broker_module=$CPS_NEB name=$CPS_NAME host=$CPS_SERVER" >> $NagiosCfgFile
            fi
    fi
